module:
  name: hello-service
  description: Greeting service
  type: container
  services:
    - name: hello-service
      command: [npm, start]
      ports:
        - name: http
          containerPort: 8080
      ingresses:
        - path: /hello
          port: http
      dependencies:
        - node-migration
  tests:
    - name: unit
      command: [npm, test]
  tasks:
    - name: node-migration
      # sleep to give postgres time to get ready
      command: ["sleep 5 && knex migrate:latest"]
      dependencies:
        - postgres-service
